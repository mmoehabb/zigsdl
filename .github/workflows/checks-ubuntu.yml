on: [push, pull_request]
name: checks-ubuntu
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install SDL3 Deps
        run: |
          sudo apt-get update
          sudo apt-get install build-essential git make \
          pkg-config cmake ninja-build gnome-desktop-testing libasound2-dev libpulse-dev \
          libaudio-dev libfribidi-dev libjack-dev libsndio-dev libx11-dev libxext-dev \
          libxrandr-dev libxcursor-dev libxfixes-dev libxi-dev libxss-dev libxtst-dev \
          libxkbcommon-dev libdrm-dev libgbm-dev libgl1-mesa-dev libgles2-mesa-dev \
          libegl1-mesa-dev libdbus-1-dev libibus-1.0-dev libudev-dev libthai-dev \
          libpipewire-0.3-dev libwayland-dev libdecor-0-dev liburing-dev libharfbuzz-dev

      - name: Setup SDL3
        run: |
          wget https://github.com/libsdl-org/SDL/releases/download/release-3.2.26/SDL3-3.2.26.tar.gz
          tar -xf SDL3-3.2.26.tar.gz
          mkdir ./SDL3-3.2.26/build
          cd ./SDL3-3.2.26/build
          cmake ..
          cmake --build . --parallel $(nproc)
          sudo cmake --install .

      - name: Setup SDL3_ttf
        run: |
          wget https://github.com/libsdl-org/SDL_ttf/releases/download/release-3.2.2/SDL3_ttf-3.2.2.tar.gz
          tar -xf SDL3_ttf-3.2.2.tar.gz
          mkdir ./SDL3_ttf-3.2.2/build
          cd ./SDL3_ttf-3.2.2/build
          cmake ..
          cmake --build . --parallel $(nproc)
          sudo cmake --install .

      - name: Setup SDL3_image
        run: |
          wget https://github.com/libsdl-org/SDL_image/releases/download/release-3.2.4/SDL3_image-3.2.4.tar.gz
          tar -xf SDL3_image-3.2.4.tar.gz
          mkdir ./SDL3_image-3.2.4/build
          cd ./SDL3_image-3.2.4/build
          cmake ..
          cmake --build . --parallel $(nproc)
          sudo cmake --install .

      - name: Setup Zig
        uses: mlugg/setup-zig@v2
        with:
          version: 0.15.2

      - name: Run unit tests
        run: zig build test --summary all
